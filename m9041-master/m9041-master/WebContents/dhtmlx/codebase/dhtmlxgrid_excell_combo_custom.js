dhtmlXGridObject.prototype._init_point_bcg=dhtmlXGridObject.prototype._init_point;dhtmlXGridObject.prototype._init_point=function(){if(!window.dhx_globalImgPath){window.dhx_globalImgPath=this.imgURL}this._col_combos=[];for(var a=0;a<this._cCount;a++){if(this.cellType[a].indexOf("combo")==0){this._col_combos[a]=eXcell_combo.prototype.initCombo.call({grid:this},a)}}if(!this._loading_handler_set){this._loading_handler_set=this.attachEvent("onXLE",function(e,d,g,f){eXcell_combo.prototype.fillColumnCombos(this,f);this.detachEvent(this._loading_handler_set)})}this._init_point=this._init_point_bcg;if(this._init_point){this._init_point()}};function eXcell_combo(a){if(!a){return}this.cell=a;this.grid=a.parentNode.grid;this._combo_pre="";this._combo_pre_width=18;this.edit=function(){if(!window.dhx_globalImgPath){window.dhx_globalImgPath=this.grid.imgURL}this.val=this.getValue();var b=this.getText();if(this.cell._clearCell){b=""}this.cell.innerHTML="";if(!this.cell._brval){this.combo=(this.grid._realfake?this.grid._fake:this.grid)._col_combos[this.cell._cellIndex]}else{this.combo=this.cell._brval}this.cell.appendChild(this.combo.DOMParent);this.combo.DOMParent.style.margin="0";this.combo.DOMelem_input.focus();this.combo.setSize(this.cell.offsetWidth-2);if(!this.combo._xml){if(this.combo.getIndexByValue(this.cell.combo_value)!=-1){this.combo.selectOption(this.combo.getIndexByValue(this.cell.combo_value))}else{if(this.combo.getOptionByLabel(b)){this.combo.selectOption(this.combo.getIndexByValue(this.combo.getOptionByLabel(b).value))}else{this.combo.setComboText(b)}}}else{this.combo.setComboText(b)}this.combo.openSelect()};this.selectComboOption=function(c,b){b.selectOption(b.getIndexByValue(b.getOptionByLabel(c).value))};this.getValue=function(b){return this.cell.combo_value};this.getText=function(b){var d=this.cell;if(this._combo_pre==""&&d.childNodes[1]){d=d.childNodes[1]}return(_isIE?d.innerText:d.textContent)};this.setValue=function(e){if(typeof(e)=="object"){this.cell._brval=this.initCombo();var c=this.cell._cellIndex;var d=this.cell.parentNode.idd;if(!e.firstChild){this.cell.combo_value="&nbsp;";this.cell._clearCell=true}else{this.cell.combo_value=e.firstChild.data}this.setComboOptions(this.cell._brval,e,this.grid,c,d)}else{this.cell.combo_value=e;var b=null;if((b=this.cell._brval)&&(typeof(this.cell._brval)=="object")){e=(b.getOption(e)||{}).text||e}else{if(b=this.grid._col_combos[this.cell._cellIndex]||((this.grid._fake)&&(b=this.grid._fake._col_combos[this.cell._cellIndex]))){e=(b.getOption(e)||{}).text||e}}if((e||"").toString()._dhx_trim()==""){e=null}if(e!==null){this.setComboCValue(e)}else{this.setComboCValue("&nbsp;","");this.cell._clearCell=true}}};this.detach=function(){this.cell.removeChild(this.combo.DOMParent);var b=this.cell.combo_value;if(!this.combo.getComboText()||this.combo.getComboText().toString()._dhx_trim()==""){this.setComboCValue("&nbsp;");this.cell._clearCell=true}else{this.setComboCValue(this.combo.getComboText(),this.combo.getActualValue());this.cell._clearCell=false}this.combo._confirmSelection();this.cell.combo_value=this.combo.getActualValue();this.combo.closeAll();this.grid._still_active=true;this.grid.setActive(1);return b!=this.cell.combo_value}}eXcell_combo.prototype=new eXcell;eXcell_combo_v=function(a){var b=new eXcell_combo(a);b._combo_pre="<img src='"+(window.dhx_globalImgPath?window.dhx_globalImgPath:this.grid.imgURL)+"combo_select_grid.gif' style='float:right;"+(_isIE?"margin-right:-3px;":"")+"'/>";b._combo_pre_width=28;return b};eXcell_combo.prototype.initCombo=function(c){var a=document.createElement("DIV");var e=this.grid.defVal[arguments.length?c:this.cell._cellIndex];var f=new dhtmlXCombo(a,"combo",0,e);this.grid.defVal[arguments.length?c:this.cell._cellIndex]="";f.DOMelem.className+=" fake_editable";var d=this.grid;f.DOMelem.onselectstart=function(){event.cancelBubble=true;return true};var b=f.getSelectedIndex();f.selectOption(b,true,true);f.attachEvent("onKeyPressed",function(g){setTimeout(function(){if(g==8||g==13||g==27){d.editStop();if(d._fake){d._fake.editStop()}}},5)});d.attachEvent("onScroll",function(h,g){d.editStop();if(d._fake){d._fake.editStop()}});dhtmlxEvent(f.DOMlist,"click",function(){setTimeout(function(){d.editStop();if(d._fake){d._fake.editStop()}},5)});f.DOMelem.style.border="0px";f.DOMelem.style.height="18px";return f};eXcell_combo.prototype.fillColumnCombos=function(c,a){if(!a){return}c.combo_columns=c.combo_columns||[];columns=c.xmlLoader.doXPath("//column",a);for(var b=0;b<columns.length;b++){if((columns[b].getAttribute("type")||"").indexOf("combo")==0){c.combo_columns[c.combo_columns.length]=b;this.setComboOptions(c._col_combos[b],columns[b],c,b)}}};eXcell_combo.prototype.setComboCValue=function(b,a){if(this._combo_pre!=""){b=this._combo_pre+"<div style='padding-top:1px; margin-top:2px;float:left;width:"+(this.cell.offsetWidth-this._combo_pre_width)+"px;line-height:"+(this.cell.offsetHeight-5)+"px;overflow:hidden'>"+b+"</div>"}if(arguments.length>1){this.setCValue(b,a)}else{this.setCValue(b)}};eXcell_combo.prototype.setComboOptions=function(f,g,b,k,m){if(convertStringToBoolean(g.getAttribute("xmlcontent"))){if(!g.getAttribute("source")){options=g.childNodes;var a=[];for(var h=0;h<options.length;h++){if(options[h].tagName=="option"){var d=options[h].firstChild?options[h].firstChild.data:"";a[a.length]=[options[h].getAttribute("value"),d]}}f.addOption(a);if(arguments.length==4){b.forEachRow(function(n){var i=b.cells(n,k);if(!i.cell._brval&&!i.cell._cellType&&(i.cell._cellIndex==k)){if(i.cell.combo_value==""){i.setComboCValue("&nbsp;","")}else{if(!f.getOption(i.cell.combo_value)){i.setComboCValue(i.cell.combo_value)}else{i.setComboCValue(f.getOption(i.cell.combo_value).text)}}}})}else{var l=(this.cell)?this:b.cells(m,k);if(g.getAttribute("text")){if(g.getAttribute("text")._dhx_trim()==""){l.setComboCValue("&nbsp;","")}else{l.setComboCValue(g.getAttribute("text"))}}else{if((!l.cell.combo_value)||(l.cell.combo_value._dhx_trim()=="")){l.setComboCValue("&nbsp;","")}else{if(!f.getOption(l.cell.combo_value)){l.setComboCValue(l.cell.combo_value)}else{l.setComboCValue(f.getOption(l.cell.combo_value).text)}}}}}}if(g.getAttribute("source")){if(g.getAttribute("auto")&&convertStringToBoolean(g.getAttribute("auto"))){if(g.getAttribute("xmlcontent")){var l=(this.cell)?this:b.cells(m,k);if(g.getAttribute("text")){l.setComboCValue(g.getAttribute("text"))}}else{b.forEachRow(function(p){var o=b.cells(p,k);if(!o.cell._brval&&!o.cell._cellType){var n=o.cell.combo_value.toString();if(n.indexOf("^")!=-1){var i=n.split("^");o.cell.combo_value=i[0];o.setComboCValue(i[1])}}})}f.enableFilteringMode(true,g.getAttribute("source"),convertStringToBoolean(g.getAttribute("cache")||true),convertStringToBoolean(g.getAttribute("sub")||false))}else{var j=this;var e=arguments.length;f.loadXML(g.getAttribute("source"),function(){if(e==4){b.forEachRow(function(o){var n=b.cells(o,k);if(!n.cell._brval&&!n.cell._cellType){if(f.getOption(n.cell.combo_value)){n.setComboCValue(f.getOption(n.cell.combo_value).text)}else{if((n.cell.combo_value||"").toString()._dhx_trim()==""){n.setComboCValue("&nbsp;","");n.cell._clearCell=true}else{n.setComboCValue(n.cell.combo_value)}}}})}else{var i=b.cells(m,k);if(f.getOption(i.cell.combo_value)){i.setComboCValue(f.getOption(i.cell.combo_value).text)}else{i.setComboCValue(i.cell.combo_value)}}})}}if(!g.getAttribute("auto")||!convertStringToBoolean(g.getAttribute("auto"))){if(g.getAttribute("editable")&&!convertStringToBoolean(g.getAttribute("editable"))){f.readonly(true)}if(g.getAttribute("filter")&&convertStringToBoolean(g.getAttribute("filter"))){f.enableFilteringMode(true)}}};eXcell_combo.prototype.getCellCombo=function(){if(this.cell._brval){return this.cell._brval}else{this.cell._brval=this.initCombo();return this.cell._brval}};dhtmlXGridObject.prototype.getColumnCombo=function(a){if(this._col_combos&&this._col_combos[a]){return this._col_combos[a]}else{if(!this._col_combos){this._col_combos=[]}this._col_combos[a]=eXcell_combo.prototype.initCombo.call({grid:this},a);return this._col_combos[a]}};